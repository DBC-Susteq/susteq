$(document).ready(function() {
  chartController = new BigData.Controller;  // Globally scoped for console play
  // chartController.adminGetKioskData();
  var stubData = JSON.parse('[{"id":2,"type":"kiosk","name":"Mr. Okey Nicolas","created_at":"2014-09-08T03:58:55.136Z","latitude":"-1.232223","longitude":"36.796778","status_code":1,"location_id":2,"transactions":[{"id":6,"transaction_time":"2014-09-08T03:58:55.163Z","location_id":2,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":170,"error_code":null,"created_at":"2014-09-08T03:58:55.165Z"},{"id":7,"transaction_time":"2014-09-08T03:58:55.167Z","location_id":2,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":200,"error_code":null,"created_at":"2014-09-08T03:58:55.168Z"},{"id":8,"transaction_time":"2014-09-08T03:58:55.170Z","location_id":2,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":90,"error_code":null,"created_at":"2014-09-08T03:58:55.171Z"},{"id":9,"transaction_time":"2014-09-08T03:58:55.173Z","location_id":2,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":190,"error_code":null,"created_at":"2014-09-08T03:58:55.174Z"},{"id":10,"transaction_time":"2014-09-08T03:58:55.176Z","location_id":2,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":110,"error_code":null,"created_at":"2014-09-08T03:58:55.177Z"}]},{"id":3,"type":"kiosk","name":"Javier Herman","created_at":"2014-09-08T03:58:55.181Z","latitude":"-1.236789","longitude":"36.721467","status_code":1,"location_id":3,"transactions":[{"id":11,"transaction_time":"2014-09-08T03:58:55.183Z","location_id":3,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":180,"error_code":null,"created_at":"2014-09-08T03:58:55.184Z"},{"id":12,"transaction_time":"2014-09-08T03:58:55.186Z","location_id":3,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":190,"error_code":null,"created_at":"2014-09-08T03:58:55.187Z"},{"id":13,"transaction_time":"2014-09-08T03:58:55.188Z","location_id":3,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":120,"error_code":null,"created_at":"2014-09-08T03:58:55.189Z"},{"id":14,"transaction_time":"2014-09-08T03:58:55.191Z","location_id":3,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":80,"error_code":null,"created_at":"2014-09-08T03:58:55.191Z"},{"id":15,"transaction_time":"2014-09-08T03:58:55.193Z","location_id":3,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":190,"error_code":null,"created_at":"2014-09-08T03:58:55.194Z"}]},{"id":4,"type":"kiosk","name":"Keyshawn Gorczany","created_at":"2014-09-08T03:58:55.197Z","latitude":"-1.327984","longitude":"36.879686","status_code":1,"location_id":4,"transactions":[{"id":16,"transaction_time":"2014-09-08T03:58:55.199Z","location_id":4,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":170,"error_code":null,"created_at":"2014-09-08T03:58:55.200Z"},{"id":17,"transaction_time":"2014-09-08T03:58:55.202Z","location_id":4,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":140,"error_code":null,"created_at":"2014-09-08T03:58:55.203Z"},{"id":18,"transaction_time":"2014-09-08T03:58:55.204Z","location_id":4,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":100,"error_code":null,"created_at":"2014-09-08T03:58:55.205Z"},{"id":19,"transaction_time":"2014-09-08T03:58:55.207Z","location_id":4,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":160,"error_code":null,"created_at":"2014-09-08T03:58:55.208Z"},{"id":20,"transaction_time":"2014-09-08T03:58:55.209Z","location_id":4,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":130,"error_code":null,"created_at":"2014-09-08T03:58:55.210Z"}]},{"id":7,"type":"kiosk","name":"Tremayne Boyer","created_at":"2014-09-08T03:58:55.938Z","latitude":"-1.277607","longitude":"36.710622","status_code":1,"location_id":7,"transactions":[{"id":31,"transaction_time":"2014-09-08T03:58:55.940Z","location_id":7,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":160,"error_code":null,"created_at":"2014-09-08T03:58:55.941Z"},{"id":32,"transaction_time":"2014-09-08T03:58:55.942Z","location_id":7,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":170,"error_code":null,"created_at":"2014-09-08T03:58:55.943Z"},{"id":33,"transaction_time":"2014-09-08T03:58:55.945Z","location_id":7,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":130,"error_code":null,"created_at":"2014-09-08T03:58:55.946Z"},{"id":34,"transaction_time":"2014-09-08T03:58:55.948Z","location_id":7,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":130,"error_code":null,"created_at":"2014-09-08T03:58:55.949Z"},{"id":35,"transaction_time":"2014-09-08T03:58:55.951Z","location_id":7,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":90,"error_code":null,"created_at":"2014-09-08T03:58:55.952Z"}]},{"id":8,"type":"kiosk","name":"Dr. Augustus Champlin","created_at":"2014-09-08T03:58:55.955Z","latitude":"-1.283465","longitude":"36.818548","status_code":-1,"location_id":8,"transactions":[{"id":36,"transaction_time":"2014-09-08T03:58:55.958Z","location_id":8,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":90,"error_code":null,"created_at":"2014-09-08T03:58:55.959Z"},{"id":37,"transaction_time":"2014-09-08T03:58:55.960Z","location_id":8,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":180,"error_code":null,"created_at":"2014-09-08T03:58:55.962Z"},{"id":38,"transaction_time":"2014-09-08T03:58:55.964Z","location_id":8,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":130,"error_code":null,"created_at":"2014-09-08T03:58:55.965Z"},{"id":39,"transaction_time":"2014-09-08T03:58:55.966Z","location_id":8,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":130,"error_code":null,"created_at":"2014-09-08T03:58:55.967Z"},{"id":40,"transaction_time":"2014-09-08T03:58:55.969Z","location_id":8,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":130,"error_code":null,"created_at":"2014-09-08T03:58:55.970Z"}]},{"id":12,"type":"kiosk","name":"Henri Johns MD","created_at":"2014-09-08T03:58:56.408Z","latitude":"-1.287152","longitude":"36.803097","status_code":0,"location_id":12,"transactions":[{"id":56,"transaction_time":"2014-09-08T03:58:56.411Z","location_id":12,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":150,"error_code":null,"created_at":"2014-09-08T03:58:56.412Z"},{"id":57,"transaction_time":"2014-09-08T03:58:56.414Z","location_id":12,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":150,"error_code":null,"created_at":"2014-09-08T03:58:56.415Z"},{"id":58,"transaction_time":"2014-09-08T03:58:56.416Z","location_id":12,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":190,"error_code":null,"created_at":"2014-09-08T03:58:56.417Z"},{"id":59,"transaction_time":"2014-09-08T03:58:56.419Z","location_id":12,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":100,"error_code":null,"created_at":"2014-09-08T03:58:56.419Z"},{"id":60,"transaction_time":"2014-09-08T03:58:56.421Z","location_id":12,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":150,"error_code":null,"created_at":"2014-09-08T03:58:56.422Z"}]},{"id":13,"type":"kiosk","name":"Ryder Keeling","created_at":"2014-09-08T03:58:56.426Z","latitude":"-1.33262","longitude":"36.934899","status_code":-1,"location_id":13,"transactions":[{"id":61,"transaction_time":"2014-09-08T03:58:56.429Z","location_id":13,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":150,"error_code":null,"created_at":"2014-09-08T03:58:56.430Z"},{"id":62,"transaction_time":"2014-09-08T03:58:56.431Z","location_id":13,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":100,"error_code":null,"created_at":"2014-09-08T03:58:56.432Z"},{"id":63,"transaction_time":"2014-09-08T03:58:56.434Z","location_id":13,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":130,"error_code":null,"created_at":"2014-09-08T03:58:56.435Z"},{"id":64,"transaction_time":"2014-09-08T03:58:56.436Z","location_id":13,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":190,"error_code":null,"created_at":"2014-09-08T03:58:56.437Z"},{"id":65,"transaction_time":"2014-09-08T03:58:56.439Z","location_id":13,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":100,"error_code":null,"created_at":"2014-09-08T03:58:56.440Z"}]},{"id":16,"type":"kiosk","name":"Pearline Zulauf","created_at":"2014-09-08T03:58:56.817Z","latitude":"-1.253862","longitude":"36.893376","status_code":0,"location_id":16,"transactions":[{"id":76,"transaction_time":"2014-09-08T03:58:56.819Z","location_id":16,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":150,"error_code":null,"created_at":"2014-09-08T03:58:56.820Z"},{"id":77,"transaction_time":"2014-09-08T03:58:56.821Z","location_id":16,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":90,"error_code":null,"created_at":"2014-09-08T03:58:56.822Z"},{"id":78,"transaction_time":"2014-09-08T03:58:56.824Z","location_id":16,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":140,"error_code":null,"created_at":"2014-09-08T03:58:56.825Z"},{"id":79,"transaction_time":"2014-09-08T03:58:56.826Z","location_id":16,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":180,"error_code":null,"created_at":"2014-09-08T03:58:56.827Z"},{"id":80,"transaction_time":"2014-09-08T03:58:56.828Z","location_id":16,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":100,"error_code":null,"created_at":"2014-09-08T03:58:56.829Z"}]},{"id":17,"type":"kiosk","name":"Terrance Prohaska IV","created_at":"2014-09-08T03:58:56.833Z","latitude":"-1.238769","longitude":"36.944379","status_code":1,"location_id":17,"transactions":[{"id":81,"transaction_time":"2014-09-08T03:58:56.835Z","location_id":17,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":130,"error_code":null,"created_at":"2014-09-08T03:58:56.835Z"},{"id":82,"transaction_time":"2014-09-08T03:58:56.837Z","location_id":17,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":170,"error_code":null,"created_at":"2014-09-08T03:58:56.838Z"},{"id":83,"transaction_time":"2014-09-08T03:58:56.840Z","location_id":17,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":140,"error_code":null,"created_at":"2014-09-08T03:58:56.841Z"},{"id":84,"transaction_time":"2014-09-08T03:58:56.842Z","location_id":17,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":80,"error_code":null,"created_at":"2014-09-08T03:58:56.843Z"},{"id":85,"transaction_time":"2014-09-08T03:58:56.845Z","location_id":17,"latitude":null,"longitude":null,"rfid_id":null,"starting_credits":null,"ending_credits":null,"transaction_code":22,"amount":90,"error_code":null,"created_at":"2014-09-08T03:58:56.845Z"}]}]')
  var parseStub = function(stubData) {
    ret = []
    dates = []
    amounts = []
    for(var i=0; i < stubData.length; i++) {
      for(var j=0; j<stubData[i].transactions.length; j++) {
        dates.push(stubData[i].transactions[j].transaction_time)
        amounts.push(stubData[i].transactions[j].amount)
      }
    }
    ret.push(dates, amounts)
    return ret
  };

  var stubby = parseStub(stubData)
  var chartPlace = document.getElementById("testChart")
  // debugger

  var sales = polyjs.data({
    date: stubby[0],
    credits: stubby[1]
  })

  polyjs.chart({
    layer: {
      data: sales,
      type: "bar",
      x: "bin(date, 'month')",
      y: "sum(credits)"
    },
    guide: {
      x: { title: "Month"},
      y: { title: ""}
    },
    title: "Credit Sales by Month",
    dom: chartPlace,
    width: 500,
    height: 250
  })
})
